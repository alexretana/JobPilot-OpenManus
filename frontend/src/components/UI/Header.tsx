import { Component, createSignal, onMount } from 'solid-js';
import type { ActivityLogEntry } from '../../types';

interface HeaderProps {
  activities?: () => ActivityLogEntry[];
  onShowTimeline?: () => void;
  onShowStatusPanel?: () => void;
  systemHealthy?: () => boolean;
  activeTab?: () => 'chat' | 'job-search' | 'resume-builder';
  onTabChange?: (tab: 'chat' | 'job-search' | 'resume-builder') => void;
}

const Header: Component<HeaderProps> = props => {
  const [currentTheme, setCurrentTheme] = createSignal('corporate');

  const themes = [
    { value: 'dark', label: 'Dark' },
    { value: 'emerald', label: 'Emerald' },
    { value: 'corporate', label: 'Corporate' },
    { value: 'business', label: 'Business' },
    { value: 'night', label: 'Night' },
    { value: 'lemonade', label: 'Lemonade' },
  ];

  onMount(() => {
    const savedTheme = localStorage.getItem('theme') || 'corporate';
    setCurrentTheme(savedTheme);
    // Set the theme on the document element
    document.documentElement.setAttribute('data-theme', savedTheme);
  });

  // Handle theme change - DaisyUI theme-controller will trigger this automatically
  const handleThemeChange = (theme: string) => {
    setCurrentTheme(theme);
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    window.dispatchEvent(new CustomEvent('themeChanged', { detail: theme }));
  };

  return (
    <header class='navbar bg-base-100 shadow-lg sticky top-0 h-[5vh] z-50'>
      <div class='navbar-start'>
        <div class='dropdown'>
          <div tabindex='0' role='button' class='btn btn-ghost lg:hidden'>
            <svg class='w-6 h-6' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
              <path
                stroke-linecap='round'
                stroke-linejoin='round'
                stroke-width='2'
                d='M4 6h16M4 12h8m-8 6h16'
              />
            </svg>
          </div>
        </div>
        <div class='flex items-center space-x-2'>
          <img src='/JobPilotIcon-Alpha.png' alt='JobPilot Logo' class='w-12 h-12' />
          <div>
            <div class='text-xl font-bold text-primary'>JobPilot</div>
            <div class='text-sm opacity-70'>AI Job Search Agent</div>
          </div>
        </div>
      </div>

      <div class='navbar-center hidden lg:flex'>
        <div class='flex gap-2'>
          <button
            class={`tab-uniform ai-chat-btn gap-2 ${
              props.activeTab?.() === 'chat' ? 'active' : ''
            }`}
            onClick={() => props.onTabChange?.('chat')}
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              class='h-4 w-4 flex-shrink-0'
              fill='none'
              viewBox='0 0 24 24'
              stroke='currentColor'
            >
              <path
                stroke-linecap='round'
                stroke-linejoin='round'
                stroke-width='2'
                d='M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z'
              />
            </svg>
            <span>AI Chat</span>
          </button>
          <button
            class={`tab-uniform tab-neutral gap-2 ${
              props.activeTab?.() === 'job-search' ? 'active' : ''
            }`}
            onClick={() => props.onTabChange?.('job-search')}
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              class='h-4 w-4 flex-shrink-0'
              viewBox='0 0 1024 1024'
              fill='currentColor'
            >
              <g fill='currentColor'>
                <path d='M433.75 16.61 C435.65 16.61 437.56 16.60 439.46 16.60 C444.58 16.59 449.69 16.59 454.81 16.60 C460.20 16.61 465.58 16.60 471.98 16.60 C481.02 16.58 490.07 16.59 499.11 16.61 C509.52 16.63 519.93 16.62 530.34 16.60 C539.33 16.58 548.32 16.58 557.31 16.59 C562.66 16.60 567.00 16.60 573.35 16.59 C578.38 16.58 583.41 16.59 588.44 16.61 C590.27 16.61 592.10 16.61 593.93 16.61 C609.45 16.55 624.67 17.93 639.44 23.07 C640.31 23.37 641.17 23.66 642.06 23.97 C656.84 29.25 670.09 36.80 681.0 47.01 C681.51 47.44 682.02 47.88 682.55 48.32 C708.34 70.40 724.32 101.25 728.0 135.01 C728.32 140.90 728.23 146.79 728.19 152.68 C728.19 154.35 728.18 156.01 728.18 157.68 C728.18 162.01 728.15 166.34 728.13 170.66 C728.11 175.10 728.10 179.54 728.10 183.98 C728.08 192.65 728.04 201.33 728.0 210.01 C728.95 210.01 729.89 210.01 730.87 210.0 C753.98 209.91 777.10 209.84 800.21 209.80 C811.39 209.78 822.57 209.76 833.75 209.71 C843.50 209.67 853.25 209.64 862.0 209.63 C867.16 209.62 872.31 209.61 877.47 209.58 C882.34 209.56 887.20 209.55 892.07 209.55 C893.84 209.55 895.61 209.54 897.38 209.53 C924.25 209.30 946.50 216.87 966.0 236.01 C966.69 236.67 967.37 237.33 968.08 238.01 C980.31 250.70 987.23 267.84 989.11 285.19 C989.20 285.96 989.28 286.73 989.37 287.53 C990.31 297.06 990.27 306.58 990.23 316.14 C990.23 318.19 990.23 320.24 990.23 322.30 C990.23 327.81 990.22 333.32 990.21 338.83 C990.19 344.61 990.19 350.39 990.19 356.18 C990.18 367.10 990.16 378.02 990.14 388.94 C990.12 401.38 990.11 413.83 990.10 426.27 C990.08 451.85 990.04 477.43 990.0 503.01 C987.0 503.01 987.0 503.01 984.47 500.55 C983.47 499.44 982.48 498.32 981.5 497.19 C980.42 495.99 979.34 494.79 978.25 493.60 C977.71 493.0 977.16 492.39 976.60 491.76 C969.32 483.78 961.47 476.70 953.0 470.01 C952.24 469.38 951.47 468.75 950.68 468.10 C899.32 425.85 828.71 400.79 762.0 404.01 C761.03 404.06 760.06 404.10 759.06 404.15 C717.89 406.29 679.24 415.21 642.0 433.01 C641.30 433.34 640.60 433.67 639.87 434.01 C614.40 446.01 591.35 462.32 570.77 481.46 C568.55 483.50 566.31 485.45 564.0 487.38 C554.29 495.84 546.11 505.99 538.36 516.22 C537.46 517.41 536.56 518.59 535.65 519.76 C527.52 530.31 520.58 541.43 514.0 553.01 C513.53 553.83 513.06 554.65 512.58 555.50 C494.69 587.19 484.21 622.11 479.0 658.01 C478.87 658.91 478.74 659.81 478.60 660.74 C472.51 705.05 480.34 748.35 492.0 791.01 C491.15 791.86 490.31 792.70 489.43 793.57 C481.41 801.57 473.39 809.58 465.37 817.58 C461.25 821.70 457.13 825.81 453.01 829.92 C449.03 833.90 445.04 837.87 441.06 841.85 C439.55 843.36 438.03 844.87 436.52 846.38 C434.39 848.51 432.26 850.64 430.13 852.77 C429.20 853.70 429.20 853.70 428.25 854.64 C412.22 870.71 400.56 888.66 392.76 909.98 C391.88 912.34 390.94 914.67 390.0 917.01 C354.46 917.08 318.92 917.13 283.37 917.16 C279.17 917.17 274.97 917.17 270.77 917.17 C269.93 917.17 269.10 917.17 268.23 917.17 C254.71 917.18 241.19 917.21 227.67 917.24 C213.78 917.27 199.90 917.29 185.01 917.29 C176.45 917.30 167.89 917.31 159.33 917.33 C153.45 917.35 147.57 917.35 141.69 917.35 C138.31 917.35 134.92 917.35 131.53 917.36 C101.67 917.48 77.16 912.44 54.81 891.13 C32.44 867.91 30.84 839.60 30.88 809.11 C30.88 806.90 30.88 804.69 30.87 802.48 C30.87 796.44 30.87 790.40 30.87 784.36 C30.88 778.50 30.88 772.65 30.87 766.79 C30.87 754.08 30.87 741.38 30.87 728.67 C30.88 717.55 30.88 706.43 30.88 695.31 C30.88 694.57 30.88 693.83 30.88 693.07 C30.88 690.07 30.88 687.07 30.88 684.08 C30.88 655.96 30.88 627.85 30.88 599.73 C30.89 574.78 30.88 549.83 30.88 524.87 C30.88 496.82 30.88 468.76 30.88 440.69 C30.88 437.70 30.88 434.70 30.88 431.71 C30.88 430.97 30.88 430.23 30.88 429.47 C30.88 418.36 30.88 407.25 30.88 396.14 C30.88 383.50 30.88 370.86 30.88 358.22 C30.88 351.78 30.88 345.33 30.88 338.88 C30.88 332.98 30.88 327.07 30.88 321.17 C30.88 319.04 30.88 316.91 30.88 314.78 C30.85 282.81 34.69 257.51 57.19 233.32 C72.65 218.45 94.56 209.80 115.90 209.89 C117.05 209.89 117.05 209.89 118.22 209.89 C120.77 209.89 123.33 209.89 125.88 209.89 C127.71 209.90 129.55 209.90 131.38 209.90 C136.34 209.90 141.31 209.90 146.27 209.90 C151.47 209.91 156.67 209.91 161.86 209.91 C171.70 209.91 181.54 209.92 191.37 209.93 C202.56 209.95 213.76 209.95 224.95 209.96 C247.98 209.97 270.0 209.99 294.0 210.01 C294.0 208.66 294.0 208.66 294.0 207.28 C293.92 198.72 293.88 190.16 293.85 181.61 C293.83 177.21 293.81 172.81 293.78 168.41 C293.75 164.15 293.73 159.89 293.72 155.63 C293.72 154.02 293.71 152.41 293.69 150.80 C293.54 135.67 295.11 120.82 300.13 106.45 C300.43 105.58 300.73 104.70 301.04 103.81 C313.03 70.21 338.44 43.47 370.5 28.20 C390.20 19.23 410.29 16.55 433.75 16.61 Z M412.0 135.0 C397.06 154.80 406.0 196.88 406.0 210.01 C475.30 210.01 544.60 210.01 616.0 210.01 C620.0 175.55 620.0 175.55 611.25 135.20 C604.96 129.09 598.47 127.89 589.93 127.87 C588.88 127.87 588.88 127.87 587.81 127.86 C585.47 127.85 583.13 127.85 580.79 127.85 C579.11 127.84 577.43 127.84 575.75 127.84 C571.19 127.82 566.63 127.82 562.06 127.81 C559.21 127.81 556.36 127.80 553.51 127.80 C544.58 127.78 535.65 127.77 526.71 127.77 C516.42 127.77 506.12 127.75 495.82 127.72 C487.86 127.70 479.89 127.69 471.92 127.69 C467.17 127.68 462.41 127.68 457.66 127.66 C453.18 127.65 448.71 127.64 444.23 127.65 C442.59 127.65 440.96 127.65 439.32 127.64 C424.90 127.37 424.90 127.37 412.0 135.0 Z' />
                <path d='M905 520 C905.89 520.69 906.77 521.39 907.68 522.10 C918.18 530.48 928.55 539.52 937 550 C937.91 551.10 938.82 552.20 939.73 553.29 C971.49 591.91 989.26 639.06 991 689 C991.06 690.48 991.06 690.48 991.13 692.0 C992.32 748.47 971.07 804.21 932.50 845.32 C930.37 847.60 928.33 849.93 926.31 852.31 C922.85 856.28 919.07 859.65 915 863 C914.22 863.65 914.22 863.65 913.42 864.31 C866.58 903.16 807.86 921.88 747 916.31 C716.83 913.02 689.10 903.89 662.21 890.0 C659.94 888.80 659.94 888.80 657 889 C654.91 890.66 654.91 890.66 652.75 892.93 C651.88 893.80 651.01 894.68 650.12 895.57 C649.16 896.55 648.20 897.53 647.24 898.51 C646.23 899.53 645.22 900.56 644.21 901.58 C642.02 903.78 639.84 905.99 637.67 908.20 C634.21 911.71 630.75 915.20 627.28 918.69 C617.42 928.62 607.58 938.57 597.75 948.54 C592.33 954.03 586.89 959.52 581.44 965.0 C577.0 968.46 573.58 971.93 570.17 975.41 C568.02 977.59 565.86 979.76 563.70 981.92 C562.71 982.92 561.73 983.92 560.75 984.92 C548.18 997.84 533.14 1005.83 514.88 1006.44 C496.83 1005.68 483.19 998.89 471 986 C459.30 972.42 456.71 956.31 458 939 C460.73 920.0 474.06 907.78 487.02 894.87 C487.98 893.90 488.95 892.93 489.92 891.97 C492.51 889.38 495.11 886.79 497.70 884.20 C500.43 881.48 503.15 878.76 505.87 876.04 C511.01 870.90 516.15 865.77 521.30 860.63 C527.16 854.78 533.02 848.93 538.88 843.07 C550.91 831.05 562.96 819.02 575 807 C573.70 803.72 572.32 800.57 570.71 797.43 C545.56 747.44 540.01 693.19 553 639 C553.18 638.23 553.37 637.46 553.56 636.67 C561.82 603.39 579.82 572.31 603 547.21 C604.74 545.29 606.41 543.32 608.06 541.31 C610.73 538.17 613.69 535.52 616.84 532.86 C618.29 531.61 619.71 530.33 621.10 529.02 C651.73 500.17 692.77 482.55 734 476 C734.73 475.88 735.46 475.77 736.21 475.65 C794.92 466.74 857.59 483.0 905 520 Z M707 584 C706.41 584.33 705.83 584.66 705.22 585.0 C675.65 601.81 654.79 629.27 645.56 661.92 C637.13 692.93 641.0 724.30 655 753 C655.48 754.0 655.97 754.99 656.47 756.02 C671.18 784.56 698.62 807.0 729 817 C762.80 827.33 797.59 824.45 829 808.19 C837.01 803.87 844.09 798.92 851 793 C851.51 792.58 852.01 792.15 852.53 791.72 C876.64 771.41 892.22 741.56 895.81 710.26 C898.83 673.89 889.27 640.50 865.73 612.49 C855.75 600.82 844.41 591.54 831 584 C829.92 583.39 828.84 582.79 827.73 582.16 C789.97 562.09 744.10 563.22 707 584 Z' />
              </g>
            </svg>
            <span>Job Search Manager</span>
          </button>
          <button
            class={`tab-uniform tab-neutral gap-2 ${
              props.activeTab?.() === 'resume-builder' ? 'active' : ''
            }`}
            onClick={() => props.onTabChange?.('resume-builder')}
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              class='h-4 w-4 flex-shrink-0'
              fill='none'
              viewBox='0 0 24 24'
              stroke='currentColor'
            >
              <path
                stroke-linecap='round'
                stroke-linejoin='round'
                stroke-width='2'
                d='M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z'
              />
            </svg>
            <span>Resume Builder</span>
          </button>
        </div>
      </div>

      <div class='navbar-end space-x-2'>
        {/* Timeline Notification Button */}
        <div class='indicator'>
          {props.activities && props.activities().length > 0 && (
            <span class='indicator-item badge badge-primary badge-sm'>
              {props.activities().length}
            </span>
          )}
          <button
            class='btn btn-ghost btn-circle'
            onClick={() => props.onShowTimeline?.()}
            title='View Timeline and Activity Log'
          >
            <svg
              class='w-6 h-6'
              xmlns='http://www.w3.org/2000/svg'
              shape-rendering='geometricPrecision'
              text-rendering='geometricPrecision'
              image-rendering='optimizeQuality'
              fill-rule='evenodd'
              clip-rule='evenodd'
              viewBox='0 0 323 512.53'
              fill='currentColor'
            >
              <path
                fill-rule='nonzero'
                d='M71.94 168.03l139.24.02c12-.05 11.88 19.83 0 19.83H71.94c-12.02 0-11.89-19.85 0-19.85zm102.75 322.39c7.81-1.03 13.98 6.6 11.33 14.02-1.38 3.76-4.59 6.41-8.57 6.94-9.19 1.17-18.43 1.45-27.68.83-34.03-2.29-64.64-17.04-87.33-39.73-24.73-24.73-40.04-58.9-40.04-96.66 0-37.73 15.31-71.91 40.04-96.65 24.74-24.73 58.92-40.04 96.66-40.04 13.09 0 25.83 1.88 38 5.4 10.09 2.91 19.68 6.95 28.64 11.95l-2.7-7.04c-2.25-5.91.72-12.52 6.63-14.78 5.9-2.25 12.53.71 14.77 6.63l11.39 29.79c.44 1.17.68 2.37.74 3.54.9 5.56-2.43 11.06-7.96 12.74l-30.5 9.33c-6.04 1.83-12.42-1.58-14.25-7.61-1.82-6.03 1.59-12.41 7.62-14.24l2.51-.77c-7.17-3.89-14.79-7.02-22.75-9.32-10.11-2.92-20.89-4.48-32.14-4.48-31.91 0-60.81 12.93-81.72 33.84-20.92 20.91-33.85 49.81-33.85 81.71 0 31.92 12.93 60.81 33.85 81.73 18.96 18.95 44.46 31.35 72.82 33.5 8.12.63 16.46.42 24.49-.63zm-36.51-170.19c0-5.83 4.72-10.57 10.56-10.57 5.84 0 10.55 4.74 10.55 10.57v64.31l44.02 19.34c5.33 2.35 7.75 8.58 5.41 13.91-2.35 5.33-8.57 7.75-13.91 5.41l-49.79-21.89c-4-1.5-6.84-5.37-6.84-9.89v-71.19zm73.32 158.9c-8.49 4.35-7.37 16.83 1.8 19.56 2.65.76 5.29.52 7.76-.71 6.81-3.43 13.36-7.45 19.49-11.99 3-2.23 4.55-5.75 4.23-9.47-.82-8.21-10.17-12.38-16.82-7.49a113.63 113.63 0 01-16.46 10.1zm43.09-37.86c-4.81 7.17.6 16.82 9.25 16.45 3.37-.19 6.39-1.84 8.3-4.67 4.27-6.35 7.97-13 11.14-19.97 3.05-6.87-1.71-14.58-9.24-14.91-4.32-.14-8.23 2.27-10.01 6.21-2.69 5.91-5.81 11.51-9.44 16.89zm19.42-54.18c-.38 4.15 1.62 8.04 5.21 10.14 6.74 3.84 15.04-.46 15.82-8.14.73-7.63.84-15.19.32-22.85-.26-3.67-2.4-6.91-5.65-8.62-7.33-3.8-16.01 1.88-15.43 10.11.44 6.49.34 12.88-.27 19.36zm-8.76-56.81c2.37 5.44 8.73 7.91 14.14 5.41 5.2-2.4 7.53-8.5 5.28-13.76a138.74 138.74 0 00-10.72-20.19c-5.18-7.96-17.37-5.64-19.25 3.67-.52 2.74-.03 5.41 1.49 7.77 3.5 5.46 6.53 11.13 9.06 17.1zM209.29 42.76l73.08 68.45h-73.08V42.76zM323 124.62c0-5.54-4.11-10.56-8.86-15.34L206.5 4.48C204.28 1.7 200.86 0 197.12 0H21.87C9.77 0 0 9.76 0 21.86v282.71c6.47-13.52 14.71-26.09 24.43-37.41V24.31h160.42v99.06c0 6.72 5.45 12.26 12.27 12.26h101.46v136.02c11.77 8.79 18.13 22.74 24.42 35.54V124.62zM71.94 97.91h66.28c12.01 0 11.86 19.83 0 19.83H71.94c-12.02 0-11.9-19.83 0-19.83z'
              />
            </svg>
          </button>
        </div>

        {/* Status Panel Button */}
        <button
          class='btn btn-ghost'
          onClick={() => props.onShowStatusPanel?.()}
          title='System Status & Quick Actions'
        >
          <div class='flex items-center space-x-2'>
            <span class='text-lg'>{props.systemHealthy?.() ? '🟢' : '🔴'}</span>
            <span class='text-sm font-medium'>Status</span>
          </div>
        </button>

        {/* Theme Selector - Pure DaisyUI Template */}
        <div class='dropdown dropdown-end'>
          <div tabindex='0' role='button' class='btn m-1'>
            Theme
            <svg
              width='12px'
              height='12px'
              class='inline-block h-2 w-2 fill-current opacity-60'
              xmlns='http://www.w3.org/2000/svg'
              viewBox='0 0 2048 2048'
            >
              <path d='M1799 349l242 241-1017 1017L7 590l242-241 775 775 775-775z'></path>
            </svg>
          </div>
          <ul
            tabindex='0'
            class='dropdown-content bg-base-300 rounded-box z-[1] w-52 p-2 shadow-2xl'
          >
            {themes.map(theme => (
              <li>
                <input
                  type='radio'
                  name='theme-dropdown'
                  class='theme-controller btn btn-sm btn-block btn-ghost justify-start'
                  aria-label={theme.label}
                  value={theme.value}
                  checked={currentTheme() === theme.value}
                  onChange={e => {
                    if (e.currentTarget.checked) {
                      handleThemeChange(theme.value);
                    }
                  }}
                />
              </li>
            ))}
          </ul>
        </div>
      </div>
    </header>
  );
};

export default Header;
